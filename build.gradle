/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.4/userguide/tutorial_java_projects.html
 */

plugins {
    // Apply the java plugin to add support for Java
    id 'java'

    // Apply the application plugin to add support for building a CLI application.
    id 'application'

    // Apply the ANTLR plugin
    id 'antlr'

    id("maven-publish")
}

repositories {
    mavenCentral()
}

dependencies {

    antlr "org.antlr:antlr:3.5.3" // use ANTLR version 3

    implementation 'com.github.rjeschke:txtmark:0.13'

    implementation 'info.picocli:picocli:4.7.6'

    annotationProcessor 'info.picocli:picocli-codegen:4.7.6'

}

group = 'com.gmigdos.glossa'
version = '2.0.0'

application {
    // Define the main class for the application.
    mainClass = 'glossa.Main'
}

task writeVersionProperties {
    doLast {
        def versionFile = file('src/main/resources/glossa/resources/version.properties')
        versionFile.parentFile.mkdirs() // Ensure the directory exists
        versionFile.text = "version: ${version}"
    }
}

compileJava.dependsOn writeVersionProperties

publishing {
    repositories {
        
        maven {
            name = "GitHubPackages"
            url = uri("https://maven.pkg.github.com/cyberpython/glossa-interpreter")
            credentials {
                username = project.findProperty("gpr.user") ?: System.getenv("USERNAME")
                password = project.findProperty("gpr.key") ?: System.getenv("TOKEN")
            }
        }

        maven {
            name = "Forgejo"
            allowInsecureProtocol = true
            url = uri("${project.findProperty("forgejo.base_url")}/api/packages/${project.findProperty("forgejo.user")}/maven")

            credentials(HttpHeaderCredentials) {
                name = "Authorization"
                value = "token ${project.findProperty('forgejo.token')}"
            }

            authentication {
                header(HttpHeaderAuthentication)
            }
        }
    }
    publications {
        glossa(MavenPublication) {
            from(components.java)
            artifactId = 'glossa-interpreter'
        }
    }
}
